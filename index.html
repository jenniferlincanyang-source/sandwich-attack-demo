<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三明治攻击 - 加密货币交易安全演示</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">🥪 三明治攻击演示</div>
        <ul class="nav-links">
            <li><a href="#intro" class="active">概念介绍</a></li>
            <li><a href="#mechanism">攻击机制</a></li>
            <li><a href="#types">攻击类型</a></li>
            <li><a href="#simulation">交互模拟</a></li>
            <li><a href="#protection">防护措施</a></li>
        </ul>
    </nav>

    <header class="hero">
        <div class="hero-content">
            <h1>三明治攻击 (Sandwich Attack)</h1>
            <p class="subtitle">深入理解 DeFi 交易中的 MEV 攻击方式</p>
            <div class="hero-stats">
                <div class="stat">
                    <span class="stat-value">$1.4B+</span>
                    <span class="stat-label">2023年 MEV 提取总额</span>
                </div>
                <div class="stat">
                    <span class="stat-value">60%+</span>
                    <span class="stat-label">三明治攻击占比</span>
                </div>
                <div class="stat">
                    <span class="stat-value">毫秒级</span>
                    <span class="stat-label">攻击执行速度</span>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- 概念介绍 -->
        <section id="intro" class="section">
            <h2>什么是三明治攻击？</h2>
            <div class="intro-grid">
                <div class="intro-text">
                    <p>三明治攻击是一种针对去中心化交易所（DEX）用户的 <strong>MEV（最大可提取价值）</strong> 攻击方式。</p>
                    <p>攻击者通过监控内存池（Mempool）中的待处理交易，在目标交易<strong>前后</strong>各插入一笔交易，像三明治一样"夹住"受害者的交易，从而获利。</p>
                    <div class="key-terms">
                        <div class="term">
                            <h4>MEV</h4>
                            <p>Maximal Extractable Value，指矿工/验证者通过重排、插入或审查交易获得的额外利润</p>
                        </div>
                        <div class="term">
                            <h4>Mempool</h4>
                            <p>内存池，存放已广播但未被打包的待处理交易</p>
                        </div>
                        <div class="term">
                            <h4>滑点</h4>
                            <p>交易执行价格与预期价格之间的差异</p>
                        </div>
                    </div>
                </div>
                <div class="intro-visual">
                    <div class="sandwich-diagram">
                        <div class="bread top-bread">
                            <span class="bread-icon">🍞</span>
                            <span>前置交易 (Front-run)</span>
                            <span class="gas-label">高 Gas</span>
                        </div>
                        <div class="filling">
                            <span class="victim-icon">👤</span>
                            <span>受害者交易</span>
                            <span class="gas-label">正常 Gas</span>
                        </div>
                        <div class="bread bottom-bread">
                            <span class="bread-icon">🍞</span>
                            <span>后置交易 (Back-run)</span>
                            <span class="gas-label">低 Gas</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 攻击机制 -->
        <section id="mechanism" class="section dark">
            <h2>攻击机制详解</h2>
            <div class="mechanism-flow">
                <div class="flow-step" data-step="1">
                    <div class="step-icon">👁️</div>
                    <h3>监控内存池</h3>
                    <p>夹子机器人持续扫描 Mempool，寻找大额 DEX 交易</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" data-step="2">
                    <div class="step-icon">🔍</div>
                    <h3>分析交易</h3>
                    <p>计算目标交易的滑点容忍度和潜在利润</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" data-step="3">
                    <div class="step-icon">⚡</div>
                    <h3>构造攻击</h3>
                    <p>创建前置买入和后置卖出交易</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step" data-step="4">
                    <div class="step-icon">💰</div>
                    <h3>获取利润</h3>
                    <p>三笔交易在同一区块执行，攻击者获利</p>
                </div>
            </div>

            <!-- 夹子机器人详解 -->
            <div class="bot-section">
                <h3>🤖 夹子机器人 (Sandwich Bot)</h3>
                <div class="bot-grid">
                    <div class="bot-card">
                        <h4>核心组件</h4>
                        <ul>
                            <li><strong>Mempool 监听器</strong> - 实时监控待处理交易</li>
                            <li><strong>利润计算器</strong> - 评估攻击收益</li>
                            <li><strong>Gas 优化器</strong> - 确保交易顺序</li>
                            <li><strong>智能合约</strong> - 原子化执行攻击</li>
                        </ul>
                    </div>
                    <div class="bot-card">
                        <h4>运行环境</h4>
                        <ul>
                            <li><strong>高性能服务器</strong> - 低延迟响应</li>
                            <li><strong>多节点连接</strong> - 快速广播交易</li>
                            <li><strong>私有 RPC</strong> - 避免被检测</li>
                            <li><strong>Flashbots</strong> - 直接提交给矿工</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 攻击类型 -->
        <section id="types" class="section">
            <h2>三明治攻击类型</h2>
            <div class="types-tabs">
                <button class="tab-btn active" data-tab="basic">基础三明治</button>
                <button class="tab-btn" data-tab="multi">多层三明治</button>
                <button class="tab-btn" data-tab="jit">JIT 流动性</button>
                <button class="tab-btn" data-tab="cross">跨池攻击</button>
            </div>

            <div class="tab-content active" id="basic-content">
                <div class="type-detail">
                    <div class="type-info">
                        <h3>基础三明治攻击</h3>
                        <p>最常见的攻击形式，针对单一交易对的大额交换。</p>
                        <div class="attack-example">
                            <h4>攻击示例</h4>
                            <ol>
                                <li>用户想用 10 ETH 买入 TOKEN</li>
                                <li>攻击者先买入 TOKEN（价格上涨）</li>
                                <li>用户交易执行（以更高价格买入）</li>
                                <li>攻击者卖出 TOKEN（获利）</li>
                            </ol>
                        </div>
                    </div>
                    <div class="type-visual">
                        <canvas id="basicChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="multi-content">
                <div class="type-detail">
                    <div class="type-info">
                        <h3>多层三明治攻击</h3>
                        <p>同时夹击多个受害者交易，提高资金利用效率。</p>
                        <div class="multi-diagram">
                            <div class="layer">前置交易</div>
                            <div class="layer victim">受害者 A</div>
                            <div class="layer victim">受害者 B</div>
                            <div class="layer victim">受害者 C</div>
                            <div class="layer">后置交易</div>
                        </div>
                    </div>
                    <div class="type-visual">
                        <div class="profit-comparison">
                            <div class="profit-bar">
                                <span class="bar-label">单层攻击</span>
                                <div class="bar" style="width: 40%"></div>
                                <span class="bar-value">$500</span>
                            </div>
                            <div class="profit-bar">
                                <span class="bar-label">多层攻击</span>
                                <div class="bar" style="width: 85%"></div>
                                <span class="bar-value">$1,200</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="jit-content">
                <div class="type-detail">
                    <div class="type-info">
                        <h3>JIT 流动性攻击</h3>
                        <p>Just-In-Time Liquidity，在交易执行前添加流动性，执行后立即移除。</p>
                        <div class="jit-flow">
                            <div class="jit-step">添加流动性</div>
                            <div class="jit-arrow">↓</div>
                            <div class="jit-step highlight">用户交易（赚取手续费）</div>
                            <div class="jit-arrow">↓</div>
                            <div class="jit-step">移除流动性</div>
                        </div>
                    </div>
                    <div class="type-visual">
                        <div class="jit-stats">
                            <div class="jit-stat">
                                <span class="value">0.3%</span>
                                <span class="label">手续费收益</span>
                            </div>
                            <div class="jit-stat">
                                <span class="value">0</span>
                                <span class="label">无常损失</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="cross-content">
                <div class="type-detail">
                    <div class="type-info">
                        <h3>跨池套利攻击</h3>
                        <p>利用多个流动性池之间的价格差异进行复合攻击。</p>
                        <div class="cross-diagram">
                            <div class="pool">Uniswap V2</div>
                            <div class="cross-arrow">⇄</div>
                            <div class="pool">Uniswap V3</div>
                            <div class="cross-arrow">⇄</div>
                            <div class="pool">SushiSwap</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 交互模拟 -->
        <section id="simulation" class="section dark">
            <h2>交互式攻击模拟</h2>
            <div class="simulation-container">
                <div class="sim-controls">
                    <h3>参数设置</h3>
                    <div class="control-group">
                        <label>交易金额 (ETH)</label>
                        <input type="range" id="tradeAmount" min="1" max="100" value="10">
                        <span id="tradeAmountValue">10 ETH</span>
                    </div>
                    <div class="control-group">
                        <label>滑点容忍度</label>
                        <input type="range" id="slippage" min="0.1" max="5" step="0.1" value="1">
                        <span id="slippageValue">1%</span>
                    </div>
                    <div class="control-group">
                        <label>池子流动性 (ETH)</label>
                        <input type="range" id="liquidity" min="100" max="10000" value="1000">
                        <span id="liquidityValue">1,000 ETH</span>
                    </div>
                    <button id="simulateBtn" class="sim-btn">开始模拟</button>
                    <button id="resetBtn" class="sim-btn secondary">重置</button>
                </div>

                <div class="sim-visualization">
                    <div class="pool-visual">
                        <h4>流动性池状态</h4>
                        <div class="pool-bars">
                            <div class="pool-bar eth">
                                <span class="bar-fill" id="ethBar"></span>
                                <span class="bar-label">ETH</span>
                            </div>
                            <div class="pool-bar token">
                                <span class="bar-fill" id="tokenBar"></span>
                                <span class="bar-label">TOKEN</span>
                            </div>
                        </div>
                        <div class="price-display">
                            当前价格: <span id="currentPrice">100</span> TOKEN/ETH
                        </div>
                    </div>

                    <div class="transaction-flow" id="txFlow">
                        <div class="tx-item pending" id="tx1">
                            <span class="tx-type">前置交易</span>
                            <span class="tx-detail">等待中...</span>
                        </div>
                        <div class="tx-item pending" id="tx2">
                            <span class="tx-type">用户交易</span>
                            <span class="tx-detail">等待中...</span>
                        </div>
                        <div class="tx-item pending" id="tx3">
                            <span class="tx-type">后置交易</span>
                            <span class="tx-detail">等待中...</span>
                        </div>
                    </div>
                </div>

                <div class="sim-results" id="simResults">
                    <h4>攻击结果</h4>
                    <div class="result-grid">
                        <div class="result-item">
                            <span class="result-label">用户预期获得</span>
                            <span class="result-value" id="expectedTokens">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">用户实际获得</span>
                            <span class="result-value negative" id="actualTokens">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">用户损失</span>
                            <span class="result-value negative" id="userLoss">-</span>
                        </div>
                        <div class="result-item highlight">
                            <span class="result-label">攻击者利润</span>
                            <span class="result-value positive" id="attackerProfit">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 超级节点 -->
        <section id="supernode" class="section">
            <h2>超级节点与 MEV 基础设施</h2>
            <div class="supernode-grid">
                <div class="node-card">
                    <div class="node-icon">🏗️</div>
                    <h3>区块构建者 (Block Builder)</h3>
                    <p>专门负责构建最优区块的实体，从搜索者处收集交易包，优化排序以最大化 MEV。</p>
                    <ul>
                        <li>Flashbots Builder</li>
                        <li>BloXroute</li>
                        <li>Eden Network</li>
                    </ul>
                </div>
                <div class="node-card">
                    <div class="node-icon">🔍</div>
                    <h3>搜索者 (Searcher)</h3>
                    <p>运行复杂算法寻找 MEV 机会的实体，包括三明治攻击、套利、清算等。</p>
                    <ul>
                        <li>高频交易策略</li>
                        <li>智能合约自动化</li>
                        <li>多链监控</li>
                    </ul>
                </div>
                <div class="node-card">
                    <div class="node-icon">⚡</div>
                    <h3>中继器 (Relay)</h3>
                    <p>连接搜索者、构建者和验证者的中间层，确保交易隐私和公平竞争。</p>
                    <ul>
                        <li>Flashbots Relay</li>
                        <li>MEV-Boost</li>
                        <li>Ultra Sound Relay</li>
                    </ul>
                </div>
            </div>

            <div class="mev-flow-diagram">
                <h3>MEV 供应链</h3>
                <div class="flow-chain">
                    <div class="chain-node">
                        <span class="icon">👤</span>
                        <span class="label">用户</span>
                    </div>
                    <div class="chain-arrow">→</div>
                    <div class="chain-node">
                        <span class="icon">📦</span>
                        <span class="label">Mempool</span>
                    </div>
                    <div class="chain-arrow">→</div>
                    <div class="chain-node highlight">
                        <span class="icon">🔍</span>
                        <span class="label">搜索者</span>
                    </div>
                    <div class="chain-arrow">→</div>
                    <div class="chain-node">
                        <span class="icon">🏗️</span>
                        <span class="label">构建者</span>
                    </div>
                    <div class="chain-arrow">→</div>
                    <div class="chain-node">
                        <span class="icon">⚡</span>
                        <span class="label">中继器</span>
                    </div>
                    <div class="chain-arrow">→</div>
                    <div class="chain-node">
                        <span class="icon">✓</span>
                        <span class="label">验证者</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 防护措施 -->
        <section id="protection" class="section dark">
            <h2>如何防护三明治攻击</h2>

            <!-- 防护策略概览 -->
            <div class="defense-overview">
                <div class="defense-intro">
                    <p>三明治攻击虽然难以完全避免，但通过合理的策略可以大幅降低被攻击的风险和损失。以下是经过验证的有效防护方法。</p>
                </div>
                <div class="defense-stats">
                    <div class="defense-stat">
                        <span class="stat-number">95%</span>
                        <span class="stat-text">使用私有交易可避免的攻击</span>
                    </div>
                    <div class="defense-stat">
                        <span class="stat-number">80%</span>
                        <span class="stat-text">低滑点设置减少的损失</span>
                    </div>
                    <div class="defense-stat">
                        <span class="stat-number">100%</span>
                        <span class="stat-text">批量拍卖DEX的保护率</span>
                    </div>
                </div>
            </div>

            <!-- 策略详解标签页 -->
            <div class="defense-tabs">
                <button class="defense-tab-btn active" data-defense="slippage">滑点控制</button>
                <button class="defense-tab-btn" data-defense="private">私有交易</button>
                <button class="defense-tab-btn" data-defense="batch">分批交易</button>
                <button class="defense-tab-btn" data-defense="dex">安全DEX</button>
                <button class="defense-tab-btn" data-defense="timing">时机选择</button>
            </div>

            <!-- 滑点控制详解 -->
            <div class="defense-content active" id="slippage-defense">
                <div class="defense-detail">
                    <div class="defense-info">
                        <h3>🛡️ 滑点控制策略</h3>
                        <p>滑点容忍度是三明治攻击的关键突破口。攻击者会根据你设置的滑点来计算最大可提取利润。</p>

                        <div class="defense-principle">
                            <h4>原理解析</h4>
                            <p>当你设置 5% 滑点时，意味着你愿意接受最多 5% 的价格偏差。攻击者可以在这个范围内操纵价格获利。</p>
                        </div>

                        <div class="slippage-guide">
                            <h4>滑点设置指南</h4>
                            <div class="slippage-levels">
                                <div class="slippage-level safe">
                                    <span class="level-value">0.1% - 0.3%</span>
                                    <span class="level-label">安全区间</span>
                                    <span class="level-desc">适合稳定币对和高流动性交易对</span>
                                </div>
                                <div class="slippage-level moderate">
                                    <span class="level-value">0.5% - 1%</span>
                                    <span class="level-label">适中区间</span>
                                    <span class="level-desc">适合主流代币交易</span>
                                </div>
                                <div class="slippage-level risky">
                                    <span class="level-value">2% - 5%</span>
                                    <span class="level-label">高风险区间</span>
                                    <span class="level-desc">仅用于低流动性代币，极易被攻击</span>
                                </div>
                            </div>
                        </div>

                        <div class="defense-tips">
                            <h4>实用技巧</h4>
                            <ul>
                                <li>先用小额测试实际滑点，再设置合理容忍度</li>
                                <li>避免使用"自动"滑点设置</li>
                                <li>交易失败时，小幅增加滑点而非大幅调整</li>
                            </ul>
                        </div>
                    </div>
                    <div class="defense-visual">
                        <div class="slippage-calculator">
                            <h4>滑点风险计算器</h4>
                            <div class="calc-input">
                                <label>交易金额 (USD)</label>
                                <input type="number" id="calcAmount" value="10000" min="100">
                            </div>
                            <div class="calc-input">
                                <label>滑点设置 (%)</label>
                                <input type="range" id="calcSlippage" min="0.1" max="5" step="0.1" value="1">
                                <span id="calcSlippageValue">1%</span>
                            </div>
                            <div class="calc-results">
                                <div class="calc-result">
                                    <span class="label">最大潜在损失</span>
                                    <span class="value negative" id="maxLoss">$100</span>
                                </div>
                                <div class="calc-result">
                                    <span class="label">攻击者利润空间</span>
                                    <span class="value warning" id="attackerSpace">$70</span>
                                </div>
                                <div class="calc-result">
                                    <span class="label">风险等级</span>
                                    <span class="value" id="riskLevel">中等</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 私有交易详解 -->
            <div class="defense-content" id="private-defense">
                <div class="defense-detail">
                    <div class="defense-info">
                        <h3>🔒 私有交易通道</h3>
                        <p>私有交易是最有效的防护手段，通过绕过公共 Mempool 直接将交易提交给区块构建者。</p>

                        <div class="defense-principle">
                            <h4>工作原理</h4>
                            <p>普通交易会广播到公共 Mempool，任何人都可以看到。私有交易则通过加密通道直接发送给可信的区块构建者，攻击者无法提前获知交易内容。</p>
                        </div>

                        <div class="private-comparison">
                            <div class="comparison-item public">
                                <h5>公共交易流程</h5>
                                <div class="flow-mini">
                                    <span>用户</span> → <span class="danger">公共Mempool</span> → <span class="danger">被监控</span> → <span>区块</span>
                                </div>
                                <p class="status danger">易被攻击</p>
                            </div>
                            <div class="comparison-item private">
                                <h5>私有交易流程</h5>
                                <div class="flow-mini">
                                    <span>用户</span> → <span class="safe">加密通道</span> → <span class="safe">构建者</span> → <span>区块</span>
                                </div>
                                <p class="status safe">安全保护</p>
                            </div>
                        </div>

                        <div class="rpc-setup">
                            <h4>如何配置私有 RPC</h4>
                            <div class="setup-steps">
                                <div class="setup-step">
                                    <span class="step-num">1</span>
                                    <span class="step-text">打开钱包设置 → 网络</span>
                                </div>
                                <div class="setup-step">
                                    <span class="step-num">2</span>
                                    <span class="step-text">添加新网络或修改现有 RPC</span>
                                </div>
                                <div class="setup-step">
                                    <span class="step-num">3</span>
                                    <span class="step-text">输入私有 RPC 地址</span>
                                </div>
                                <div class="setup-step">
                                    <span class="step-num">4</span>
                                    <span class="step-text">保存并切换到新网络</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="defense-visual">
                        <div class="rpc-list">
                            <h4>推荐私有 RPC 服务</h4>
                            <div class="rpc-item">
                                <div class="rpc-header">
                                    <span class="rpc-name">Flashbots Protect</span>
                                    <span class="rpc-badge free">免费</span>
                                </div>
                                <div class="rpc-url">
                                    <code>https://rpc.flashbots.net</code>
                                    <button class="copy-btn" data-copy="https://rpc.flashbots.net">复制</button>
                                </div>
                                <p class="rpc-desc">最流行的免费私有交易服务，支持以太坊主网</p>
                            </div>
                            <div class="rpc-item">
                                <div class="rpc-header">
                                    <span class="rpc-name">MEV Blocker</span>
                                    <span class="rpc-badge free">免费</span>
                                </div>
                                <div class="rpc-url">
                                    <code>https://rpc.mevblocker.io</code>
                                    <button class="copy-btn" data-copy="https://rpc.mevblocker.io">复制</button>
                                </div>
                                <p class="rpc-desc">多构建者竞价，可能获得 MEV 返还</p>
                            </div>
                            <div class="rpc-item">
                                <div class="rpc-header">
                                    <span class="rpc-name">Securerpc</span>
                                    <span class="rpc-badge free">免费</span>
                                </div>
                                <div class="rpc-url">
                                    <code>https://api.securerpc.com/v1</code>
                                    <button class="copy-btn" data-copy="https://api.securerpc.com/v1">复制</button>
                                </div>
                                <p class="rpc-desc">Manifold Finance 提供的安全 RPC</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 分批交易详解 -->
            <div class="defense-content" id="batch-defense">
                <div class="defense-detail">
                    <div class="defense-info">
                        <h3>📊 分批交易策略</h3>
                        <p>将大额交易拆分成多笔小额交易，可以显著降低每笔交易的攻击价值，使攻击变得无利可图。</p>

                        <div class="defense-principle">
                            <h4>为什么有效</h4>
                            <p>三明治攻击需要支付 Gas 费用。当单笔交易金额较小时，攻击者的潜在利润可能无法覆盖 Gas 成本，从而放弃攻击。</p>
                        </div>

                        <div class="batch-formula">
                            <h4>分批计算公式</h4>
                            <div class="formula-box">
                                <p><strong>建议单笔金额</strong> = 池子流动性 × 0.5% ~ 1%</p>
                                <p><strong>分批数量</strong> = 总金额 ÷ 单笔金额</p>
                            </div>
                        </div>

                        <div class="batch-example">
                            <h4>实例演示</h4>
                            <div class="example-scenario">
                                <p><strong>场景：</strong>想用 100 ETH 购买某代币</p>
                                <p><strong>池子流动性：</strong>5,000 ETH</p>
                                <p><strong>建议单笔：</strong>25-50 ETH</p>
                                <p><strong>分批数量：</strong>2-4 笔</p>
                            </div>
                        </div>

                        <div class="defense-tips">
                            <h4>注意事项</h4>
                            <ul>
                                <li>分批会增加总 Gas 费用</li>
                                <li>在不同区块执行可能面临价格波动</li>
                                <li>可结合私有交易使用效果更佳</li>
                            </ul>
                        </div>
                    </div>
                    <div class="defense-visual">
                        <div class="batch-simulator">
                            <h4>分批策略模拟器</h4>
                            <div class="batch-input">
                                <label>总交易金额 (ETH)</label>
                                <input type="number" id="batchTotal" value="100" min="1">
                            </div>
                            <div class="batch-input">
                                <label>池子流动性 (ETH)</label>
                                <input type="number" id="batchLiquidity" value="5000" min="100">
                            </div>
                            <button id="calcBatch" class="calc-btn">计算最优分批</button>
                            <div class="batch-results">
                                <div class="batch-result">
                                    <span class="label">建议分批数</span>
                                    <span class="value" id="batchCount">-</span>
                                </div>
                                <div class="batch-result">
                                    <span class="label">每批金额</span>
                                    <span class="value" id="batchSize">-</span>
                                </div>
                                <div class="batch-result">
                                    <span class="label">价格影响</span>
                                    <span class="value" id="priceImpact">-</span>
                                </div>
                            </div>
                            <div class="batch-visual-bars" id="batchBars">
                                <!-- 动态生成分批可视化 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 安全DEX详解 -->
            <div class="defense-content" id="dex-defense">
                <div class="defense-detail">
                    <div class="defense-info">
                        <h3>🔄 抗MEV去中心化交易所</h3>
                        <p>一些新型 DEX 从协议层面设计了抗 MEV 机制，从根本上消除三明治攻击的可能性。</p>

                        <div class="dex-types">
                            <div class="dex-type">
                                <h4>批量拍卖 DEX</h4>
                                <p>将一段时间内的所有订单收集起来，统一以相同价格执行，消除交易排序优势。</p>
                                <div class="dex-example">
                                    <strong>代表：</strong>CoW Swap, CrocSwap
                                </div>
                            </div>
                            <div class="dex-type">
                                <h4>意图交易 DEX</h4>
                                <p>用户只表达交易意图，由求解者竞争提供最优执行路径。</p>
                                <div class="dex-example">
                                    <strong>代表：</strong>1inch Fusion, UniswapX
                                </div>
                            </div>
                            <div class="dex-type">
                                <h4>时间加权 DEX</h4>
                                <p>使用时间加权平均价格（TWAP）执行大额订单。</p>
                                <div class="dex-example">
                                    <strong>代表：</strong>TWAP 订单功能
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="defense-visual">
                        <div class="dex-comparison-table">
                            <h4>DEX 安全性对比</h4>
                            <table class="comparison-table">
                                <thead>
                                    <tr>
                                        <th>DEX</th>
                                        <th>MEV保护</th>
                                        <th>Gas费用</th>
                                        <th>执行速度</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Uniswap</td>
                                        <td class="rating low">无</td>
                                        <td class="rating medium">中等</td>
                                        <td class="rating high">即时</td>
                                    </tr>
                                    <tr>
                                        <td>CoW Swap</td>
                                        <td class="rating high">完全</td>
                                        <td class="rating high">低/无</td>
                                        <td class="rating low">批次</td>
                                    </tr>
                                    <tr>
                                        <td>1inch Fusion</td>
                                        <td class="rating high">高</td>
                                        <td class="rating high">无</td>
                                        <td class="rating medium">中等</td>
                                    </tr>
                                    <tr>
                                        <td>UniswapX</td>
                                        <td class="rating medium">中等</td>
                                        <td class="rating high">低</td>
                                        <td class="rating medium">中等</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 时机选择详解 -->
            <div class="defense-content" id="timing-defense">
                <div class="defense-detail">
                    <div class="defense-info">
                        <h3>⏰ 交易时机选择</h3>
                        <p>选择合适的交易时机可以降低被攻击的概率和成本。</p>

                        <div class="timing-factors">
                            <div class="timing-factor">
                                <h4>Gas 价格</h4>
                                <p>低 Gas 时期攻击成本更低，但你的交易成本也更低。高 Gas 时期攻击者需要更高利润才会行动。</p>
                            </div>
                            <div class="timing-factor">
                                <h4>网络拥堵</h4>
                                <p>网络拥堵时，交易排序竞争激烈，攻击成功率可能降低。</p>
                            </div>
                            <div class="timing-factor">
                                <h4>市场波动</h4>
                                <p>高波动期间价格变化快，攻击者风险增加，但你也面临更大滑点。</p>
                            </div>
                        </div>

                        <div class="timing-recommendations">
                            <h4>最佳交易时段</h4>
                            <div class="time-slots">
                                <div class="time-slot good">
                                    <span class="time">UTC 4:00-8:00</span>
                                    <span class="desc">亚洲早盘，Gas 较低</span>
                                </div>
                                <div class="time-slot moderate">
                                    <span class="time">UTC 12:00-14:00</span>
                                    <span class="desc">欧美交接，活动适中</span>
                                </div>
                                <div class="time-slot avoid">
                                    <span class="time">UTC 14:00-20:00</span>
                                    <span class="desc">美国活跃时段，竞争激烈</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="defense-visual">
                        <div class="gas-tracker">
                            <h4>Gas 价格参考</h4>
                            <div class="gas-levels">
                                <div class="gas-level">
                                    <span class="gas-icon low">🟢</span>
                                    <span class="gas-range">&lt; 20 Gwei</span>
                                    <span class="gas-label">低 - 适合大额交易</span>
                                </div>
                                <div class="gas-level">
                                    <span class="gas-icon medium">🟡</span>
                                    <span class="gas-range">20-50 Gwei</span>
                                    <span class="gas-label">中等 - 正常交易</span>
                                </div>
                                <div class="gas-level">
                                    <span class="gas-icon high">🔴</span>
                                    <span class="gas-range">&gt; 50 Gwei</span>
                                    <span class="gas-label">高 - 考虑延迟交易</span>
                                </div>
                            </div>
                        </div>
                        <div class="timing-tips-box">
                            <h4>额外建议</h4>
                            <ul>
                                <li>使用 Gas 追踪工具监控最佳时机</li>
                                <li>设置 Gas 价格上限避免意外高费用</li>
                                <li>非紧急交易可等待低 Gas 时段</li>
                                <li>周末通常 Gas 较低</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 综合防护检查清单 -->
            <div class="defense-checklist">
                <h3>🔍 交易前安全检查清单</h3>
                <div class="checklist-grid">
                    <label class="checklist-item">
                        <input type="checkbox" id="check1">
                        <span class="checkmark"></span>
                        <span class="check-text">已配置私有 RPC（Flashbots/MEV Blocker）</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox" id="check2">
                        <span class="checkmark"></span>
                        <span class="check-text">滑点设置在 1% 以下</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox" id="check3">
                        <span class="checkmark"></span>
                        <span class="check-text">交易金额小于池子流动性的 1%</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox" id="check4">
                        <span class="checkmark"></span>
                        <span class="check-text">已检查当前 Gas 价格</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox" id="check5">
                        <span class="checkmark"></span>
                        <span class="check-text">考虑使用 CoW Swap 等抗MEV DEX</span>
                    </label>
                    <label class="checklist-item">
                        <input type="checkbox" id="check6">
                        <span class="checkmark"></span>
                        <span class="check-text">大额交易已规划分批策略</span>
                    </label>
                </div>
                <div class="checklist-score">
                    <span>安全评分: </span>
                    <span id="safetyScore">0</span>
                    <span>/6</span>
                    <div class="score-bar">
                        <div class="score-fill" id="scoreFill"></div>
                    </div>
                </div>
            </div>

            <!-- 工具推荐 -->
            <div class="tools-section">
                <h3>防护工具推荐</h3>
                <div class="tools-grid">
                    <a href="https://protect.flashbots.net" target="_blank" class="tool-link">
                        <span class="tool-name">Flashbots Protect</span>
                        <span class="tool-desc">免费私有交易 RPC，最流行的 MEV 保护方案</span>
                        <span class="tool-tag">必备</span>
                    </a>
                    <a href="https://mevblocker.io" target="_blank" class="tool-link">
                        <span class="tool-name">MEV Blocker</span>
                        <span class="tool-desc">多构建者竞价保护，可能获得 MEV 返还</span>
                        <span class="tool-tag">推荐</span>
                    </a>
                    <a href="https://swap.cow.fi" target="_blank" class="tool-link">
                        <span class="tool-name">CoW Swap</span>
                        <span class="tool-desc">批量拍卖 DEX，从协议层面杜绝 MEV</span>
                        <span class="tool-tag">最安全</span>
                    </a>
                    <a href="https://app.1inch.io" target="_blank" class="tool-link">
                        <span class="tool-name">1inch Fusion</span>
                        <span class="tool-desc">无 Gas 限价订单，求解者竞争最优价格</span>
                        <span class="tool-tag">省Gas</span>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>本演示仅用于教育目的，帮助用户理解和防范三明治攻击</p>
        <p>© 2024 三明治攻击演示 | 安全交易，从了解风险开始</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
